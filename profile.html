<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Beforexam",
    "url": "https://beforexam.vercel.app"
  }
</script>

<!-- Organization Schema -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Beforexam",
    "url": "https://beforexam.vercel.app",
    "logo": "https://beforexam.vercel.app/assets/favicon/android-chrome-512x512.png"
  }
</script>
<link rel="stylesheet" href="assets/css/common.css">
<link rel="stylesheet" href="/assets/css/profile.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- FAVICONS -->
<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
<link rel="icon" href="assets/favicon/favicon.ico">

<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">

<link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="assets/favicon/android-chrome-512x512.png">

<link rel="manifest" href="assets/favicon/site.webmanifest">


</head>

<body>
<main class="profile-content">

  <!-- ===== PROFILE SKELETON (VISIBLE FIRST) ===== -->
  <div id="profileSkeleton">

    <!-- Header skeleton -->
    <div class="pr-skel-header"></div>

    <!-- Card skeleton -->
    <div class="pr-skel-card">

      <div class="pr-skel-title"></div>

      <div class="pr-skel-field"></div>
      <div class="pr-skel-field"></div>
      <div class="pr-skel-field"></div>

      <div class="pr-skel-btn"></div>
    </div>

  </div>


  <!-- ===== REAL PROFILE CONTENT (HIDDEN FIRST) ===== -->
  <div id="profileContent" style="display:none;">

    <!-- HEADER -->
    <div class="perform-header">
      <h2>My Profile</h2>

      <div class="header-actions">
        <button id="editProfile" class="edit-inline-btn"><svg class="icon-pencil" viewBox="0 0 24 24" fill="none"
     stroke="currentColor" stroke-width="1.6"
     stroke-linecap="round" stroke-linejoin="round">
  <path d="M12 20h9"/>
  <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
</svg>Edit
        </button>

        <button class="edit-inline-btn" onclick="history.back()">
          <i class="fa-solid fa-arrow-left"></i>Back
        </button>
      </div>
    </div>

    <div class="profile-card">

      <h3 class="profile-title">Profile Details</h3>
<!-- Profile Picture -->
<div class="field profile-f">

  <!-- Profile strip -->
  <div class="pfp-strip">

    <!-- particles canvas (if you already have it) -->
    <canvas id="pfpParticles"></canvas>

    <!-- profile circle -->
    <div id="pfpCircle" class="pfp-circle">
      <img id="pfpImage" src="...">
    </div>

  </div>

  <!-- popup remains outside strip -->
  <div id="pfpPopup" class="pfp-popup"></div>

</div>
      <!-- Username -->
      <div class="field">
        <label>Username</label>
        <input type="text" id="username">
      </div>

      <!-- DOB -->
      <div class="field dob-field">
        <label>Date of Birth</label>
        <input type="date" id="dob">
        <small class="hint">You must be at least 17 years old</small>
      </div>

      <!-- Gender -->
      <div class="field">
        <label>Gender</label>

        <button id="genderBtn" class="select-btn">
          <span id="genderText">Select Gender</span>
        </button>

        <div id="genderPopup" class="select-popup">
          <button data-val="Male">Male</button>
          <button data-val="Female">Female</button>
          <button data-val="Other">Other</button>
          <button data-val="Prefer not to say">Prefer not to say</button>
        </div>
      </div>

      <!-- Save -->
      <button id="saveProfile" class="save-btn">
        Save Profile
      </button>

      <p id="profileMsg" class="msg"></p>

    </div>

  </div>

</main>
<script type="module">
import { auth } from "./assets/js/firebase.js";

auth.onAuthStateChanged(user => {
  if (!user) return;
});
</script>
<script type="module">

const strip = document.querySelector(".pfp-strip");
const img = document.getElementById("pfpImage");

/* ---------- MAIN FUNCTION ---------- */
function updateStripColor(){

  if (!img || !strip) return;
  if (!img.complete || img.naturalWidth === 0) return; 
  // prevents DOMException

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  const size = 50;
  canvas.width = size;
  canvas.height = size;

  ctx.drawImage(img, 0, 0, size, size);

  const data = ctx.getImageData(0,0,size,size).data;

  let r=0,g=0,b=0,count=0;
  for(let i=0;i<data.length;i+=4){
    r+=data[i];
    g+=data[i+1];
    b+=data[i+2];
    count++;
  }

  r = Math.floor(r/count);
  g = Math.floor(g/count);
  b = Math.floor(b/count);

  const r2 = Math.min(255, r+60);
  const g2 = Math.min(255, g+60);
  const b2 = Math.min(255, b+60);

  strip.style.setProperty("--strip-color-1", `rgb(${r},${g},${b})`);
  strip.style.setProperty("--strip-color-2", `rgb(${r2},${g2},${b2})`);

if(document.body.classList.contains("dark")){
  const dr = Math.max(0, r - 40);
  const dg = Math.max(0, g - 40);
  const db = Math.max(0, b - 40);

  const dr2 = Math.min(255, dr + 50);
  const dg2 = Math.min(255, dg + 50);
  const db2 = Math.min(255, db + 50);

  strip.style.setProperty("--strip-color-1", `rgb(${dr},${dg},${db})`);
  strip.style.setProperty("--strip-color-2", `rgb(${dr2},${dg2},${db2})`);
}

/* ---------- AUTO UPDATE WHEN IMAGE LOADS ---------- */
img.addEventListener("load", updateStripColor);
}
/* ---------- EXPOSE TO OTHER MODULES ---------- */
window.updateStripColor = updateStripColor;

</script>
  <script src="assets/js/common-layout.js"></script>
  <script type="module" src="assets/js/profile.js"></script>
<script type="module" src="assets/js/firebase.js"></script>
<script type="module" src="assets/js/user-metrics-init.js"></script>
<script type="module" src="assets/js/common.js"></script>
</body>
</html>