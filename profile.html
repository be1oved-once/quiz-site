<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Beforexam",
    "url": "https://beforexam.vercel.app"
  }
</script>

<!-- Organization Schema -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Beforexam",
    "url": "https://beforexam.vercel.app",
    "logo": "https://beforexam.vercel.app/assets/favicon/android-chrome-512x512.png"
  }
</script>
<link rel="stylesheet" href="assets/css/common.css">
<link rel="stylesheet" href="/assets/css/profile.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- FAVICONS -->
<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
<link rel="icon" href="assets/favicon/favicon.ico">

<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">

<link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="assets/favicon/android-chrome-512x512.png">

<link rel="manifest" href="assets/favicon/site.webmanifest">


</head>

<body>
<main class="profile-content">

  <!-- ===== PROFILE SKELETON (VISIBLE FIRST) ===== -->
  <div id="profileSkeleton">

    <!-- Header skeleton -->
    <div class="pr-skel-header"></div>

    <!-- Card skeleton -->
    <div class="pr-skel-card">

      <div class="pr-skel-title"></div>

      <div class="pr-skel-field"></div>
      <div class="pr-skel-field"></div>
      <div class="pr-skel-field"></div>

      <div class="pr-skel-btn"></div>
    </div>

  </div>


  <!-- ===== REAL PROFILE CONTENT (HIDDEN FIRST) ===== -->
  <div id="profileContent" style="display:none;">

    <!-- HEADER -->
    <div class="perform-header">
      <h2>My Profile</h2>

      <div class="header-actions">
        <button id="editProfile" class="edit-inline-btn"><svg class="icon-pencil" viewBox="0 0 24 24" fill="none"
     stroke="currentColor" stroke-width="1.6"
     stroke-linecap="round" stroke-linejoin="round">
  <path d="M12 20h9"/>
  <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
</svg>Edit
        </button>

        <button class="edit-inline-btn" onclick="history.back()">
          <i class="fa-solid fa-arrow-left"></i>Back
        </button>
      </div>
    </div>

    <div class="profile-card">

      <h3 class="profile-title">Profile Details</h3>
<!-- Profile Picture -->
<div class="field profile-f">

  <!-- Profile strip -->
  <div class="pfp-strip">

    <!-- particles canvas (if you already have it) -->
    <canvas id="pfpParticles"></canvas>
<div class="noise-layer"></div>
    <!-- profile circle -->
    <div id="pfpCircle" class="pfp-circle">
      <img id="pfpImage" src="...">
    </div>

  </div>

  <!-- popup remains outside strip -->
  <div id="pfpPopup" class="pfp-popup"></div>

</div>
      <!-- Username -->
      <div class="field">
        <label>Username</label>
        <input type="text" id="username">
      </div>

      <!-- DOB -->
<div class="field dob-field">
  <label>Date of Birth</label>

  <!-- Button that opens picker -->
  <button id="dobBtn" class="dob-display-btn">
    Select Date of Birth
  </button>

  <!-- Hidden actual input (used by profile.js) -->
  <input type="hidden" id="dob">

  <small class="hint">You must be at least 17 years old</small>
</div>

      <!-- Gender -->
      <div class="field">
        <label>Gender</label>

        <button id="genderBtn" class="select-btn">
          <span id="genderText">Select Gender</span>
        </button>

        <div id="genderPopup" class="select-popup">
          <button data-val="Male">Male</button>
          <button data-val="Female">Female</button>
          <button data-val="Other">Other</button>
          <button data-val="Prefer not to say">Prefer not to say</button>
        </div>
      </div>

      <!-- Save -->
      <button id="saveProfile" class="save-btn">
        Save Profile
      </button>

      <p id="profileMsg" class="msg"></p>

    </div>

  </div>

</main>
<!-- ===== DOB PICKER SHEET ===== -->

<div id="dobSheet" class="dob-sheet">

  <div class="dob-header">
    <button id="dobClose">Close</button>
    <div>Select Date</div>
    <button id="dobDone">Done</button>
  </div>

  <div class="dob-divider"></div>

  <div class="dob-wheels">
    <div class="dob-wheel" id="dayWheel"></div>
    <div class="dob-wheel" id="monthWheel"></div>
    <div class="dob-wheel" id="yearWheel"></div>
  </div>

  <div class="dob-divider"></div>

</div>
<script type="module">
import { auth } from "./assets/js/firebase.js";

auth.onAuthStateChanged(user => {
  if (!user) return;
});
</script>
<script type="module">
const strip = document.querySelector(".pfp-strip");
const img = document.getElementById("pfpImage");

function updateStripColor(){
  if (!img || !strip) return;
  if (!img.complete || img.naturalWidth === 0) return;

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  // smaller sample for speed
  const size = 40;
  canvas.width = size;
  canvas.height = size;
  ctx.drawImage(img, 0, 0, size, size);

  const data = ctx.getImageData(0,0,size,size).data;

  let rTotal=0, gTotal=0, bTotal=0, count=0;
  let rBright=0, gBright=0, bBright=0, brightScore=0;

  for(let i=0;i<data.length;i+=4){
    const r = data[i];
    const g = data[i+1];
    const b = data[i+2];

    // average color
    rTotal += r;
    gTotal += g;
    bTotal += b;
    count++;

    // find most saturated bright color
    const saturation = Math.max(r,g,b) - Math.min(r,g,b);
    const brightness = r + g + b;

    const score = saturation * 1.2 + brightness * 0.3;
    if(score > brightScore){
      brightScore = score;
      rBright = r;
      gBright = g;
      bBright = b;
    }
  }

  // average base color
  let r1 = Math.floor(rTotal / count);
  let g1 = Math.floor(gTotal / count);
  let b1 = Math.floor(bTotal / count);

  // vibrant accent color
  let r2 = rBright;
  let g2 = gBright;
  let b2 = bBright;

  // small boost so gradient pops
  r2 = Math.min(255, r2 + 40);
  g2 = Math.min(255, g2 + 40);
  b2 = Math.min(255, b2 + 40);

  // dark mode correction
  if(document.body.classList.contains("dark")){
    r1 = Math.max(0, r1 - 40);
    g1 = Math.max(0, g1 - 40);
    b1 = Math.max(0, b1 - 40);

    r2 = Math.max(0, r2 - 20);
    g2 = Math.max(0, g2 - 20);
    b2 = Math.max(0, b2 - 20);
  }

  // apply as CSS variables
  strip.style.setProperty("--strip-color-1", `rgb(${r1},${g1},${b1})`);
  strip.style.setProperty("--strip-color-2", `rgb(${r2},${g2},${b2})`);
}

// run on load
img.addEventListener("load", updateStripColor);

// expose for avatar change calls
window.updateStripColor = updateStripColor;
// ==== PARTICLE ORBIT ENGINE ====

const canvas = document.getElementById("pfpParticles");
const ctxP = canvas.getContext("2d");
const stripBox = document.querySelector(".pfp-strip");
const circle = document.getElementById("pfpCircle");

let particles = [];
const PARTICLE_COUNT = 45;

function resizeParticles(){
  canvas.width = stripBox.clientWidth;
  canvas.height = stripBox.clientHeight;
}
window.addEventListener("resize", resizeParticles);
resizeParticles();

// Create particles
function initParticles(){
  particles = [];
  for(let i=0;i<PARTICLE_COUNT;i++){
    particles.push({
      angle: Math.random()*Math.PI*2,
      radius: 35 + Math.random()*45,
      speed: 0.002 + Math.random()*0.004,
      size: 1 + Math.random()*2.5,
      alpha: 0.4 + Math.random()*0.6
    });
  }
}
initParticles();

function animateParticles(){
  ctxP.clearRect(0,0,canvas.width,canvas.height);

  const cx = canvas.width/2;
  const cy = canvas.height/2;

  particles.forEach(p=>{
    p.angle += p.speed;

    const x = cx + Math.cos(p.angle) * p.radius;
    const y = cy + Math.sin(p.angle) * p.radius;

    ctxP.fillStyle = `rgba(255,255,255,${p.alpha})`;
    ctxP.beginPath();
    ctxP.arc(x,y,p.size,0,Math.PI*2);
    ctxP.fill();
  });

  requestAnimationFrame(animateParticles);
}

animateParticles();
if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientation", e=>{
    const x = e.gamma; // left-right
    const y = e.beta;  // front-back

    stripBox.style.transform =
      `rotateX(${y/15}deg) rotateY(${x/15}deg)`;
  });
}
// ===== DOB PICKER ENGINE =====

const dobBtn = document.getElementById("dobBtn");
const dobSheet = document.getElementById("dobSheet");
const dobClose = document.getElementById("dobClose");
const dobDone = document.getElementById("dobDone");

const dayWheel = document.getElementById("dayWheel");
const monthWheel = document.getElementById("monthWheel");
const yearWheel = document.getElementById("yearWheel");

const dobHiddenInput = document.getElementById("dob");

function openDob(){
  if (!window.profileEditMode) return;
  dobSheet.classList.add("show");
}

function closeDob(){
  dobSheet.classList.remove("show");
}

dobBtn.onclick = openDob;
dobClose.onclick = closeDob;

const ITEM_HEIGHT = 36;
const LOOP = 120;

// Data
const days = Array.from({length:31},(_,i)=>String(i+1).padStart(2,"0"));
const months = Array.from({length:12},(_,i)=>String(i+1).padStart(2,"0"));

// Year range (17+ rule)
const nowY = new Date().getFullYear();
const maxY = nowY - 17;
const minY = maxY - 90;
const years = Array.from({length:maxY-minY+1},(_,i)=>String(maxY-i));

// Build infinite wheels
function buildWheel(el, values){
  el.innerHTML="";
  for(let i=0;i<LOOP;i++){
    values.forEach(v=>{
      const div=document.createElement("div");
      div.className="wheel-item";
      div.textContent=v;
      el.appendChild(div);
    });
  }
}

// Activate wheel logic
function attachWheel(wheel, values){
  const total = wheel.children.length;
  wheel.scrollTop = (total/2)*ITEM_HEIGHT;

  function update(){
    const index = Math.round(wheel.scrollTop/ITEM_HEIGHT);
    wheel.querySelectorAll(".wheel-item").forEach((it,i)=>{
      it.classList.toggle("active", i===index);
    });
  }

  wheel.addEventListener("scroll", ()=> requestAnimationFrame(update));
  wheel.addEventListener("touchend", ()=>{
    const index=Math.round(wheel.scrollTop/ITEM_HEIGHT);
    wheel.scrollTo({top:index*ITEM_HEIGHT,behavior:"smooth"});
  });

  update();
}

buildWheel(dayWheel, days);
buildWheel(monthWheel, months);
buildWheel(yearWheel, years);

attachWheel(dayWheel, days);
attachWheel(monthWheel, months);
attachWheel(yearWheel, years);

// Done
dobDone.onclick = ()=>{
  const dIndex = Math.round(dayWheel.scrollTop/ITEM_HEIGHT);
  const mIndex = Math.round(monthWheel.scrollTop/ITEM_HEIGHT);
  const yIndex = Math.round(yearWheel.scrollTop/ITEM_HEIGHT);

  const day = days[(dIndex%days.length+days.length)%days.length];
  const month = months[(mIndex%months.length+months.length)%months.length];
  const year = years[(yIndex%years.length+years.length)%years.length];

  const finalDOB = `${year}-${month}-${day}`; 
  dobHiddenInput.value = finalDOB;
  dobBtn.textContent = `${day}-${month}-${year}`;

  dobSheet.classList.remove("show");
};
</script>
  <script src="assets/js/common-layout.js"></script>
  <script type="module" src="assets/js/profile.js"></script>
<script type="module" src="assets/js/firebase.js"></script>
<script type="module" src="assets/js/user-metrics-init.js"></script>
<script type="module" src="assets/js/common.js"></script>
</body>
</html>